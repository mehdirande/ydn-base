<h1 class="classTitle">Class ydn.db.Query</h1>



<table cellspacing="0" class="summaryTable">
  <caption>
    Class Summary
  </caption>

  <thead>
  <tr>
    <th>Constructor Attributes</th>

    <th>Constructor Name and Description</th>
  </tr>
  </thead>




  <tbody>



  <tr>



    <td class="attributes">&nbsp;</td>




    <td class="nameDescription">



      <div class="fixedFont">
        <b><a href="#constructor">Query</a></b>(store_name)
      </div>




      <div class="description">
        Create a store-wise query.
      </div>
    </td>
  </tr>



  <tr>



    <td class="attributes">&nbsp;</td>



    <td class="nameDescription">



      <div class="fixedFont">
        <b><a href="#constructor">Query</a></b>(store_name, index)
      </div>




      <div class="description">
        Create a store-wise query with ordering in given index field.
      </div>
    </td>
  </tr>



  <tr>


    <td class="attributes">&nbsp;</td>


    <td class="nameDescription">


      <div class="fixedFont">
        <b><a href="#constructor">Query</a></b>(store_name, index, direction, key_range)
      </div>


      <div class="description">
        Create a key range query.
      </div>
    </td>
  </tr>

  <tr>


    <td class="attributes">&nbsp;</td>


    <td class="nameDescription">


      <div class="fixedFont">
        <b><a href="#constructor">Query</a></b>(store_name, index, direction, lower, upper, lowerOpen, upperOpen)
      </div>


      <div class="description">
        Create a key range query.
      </div>
    </td>
  </tr>


  </tbody>
</table>


<table cellspacing="0" class="summaryTable">



  <caption>
    Field Summary
  </caption>




  <thead>



  <tr>



    <th>Field Attributes</th>




    <th>Field Name and Description</th>
  </tr>
  </thead>




  <tbody>




  <tr>



    <td class="attributes">&nbsp;</td>




    <td class="nameDescription">



      <div class="fixedFont">
        <b><a href="#filter">filter</a></b>
      </div>




      <div class="description">
        <em>Filter</em> iteration function to decide whether the resulting record to put into the result or not.
      </div>
    </td>
  </tr>




  <tr>



    <td class="attributes">&nbsp;</td>




    <td class="nameDescription">



      <div class="fixedFont">
        <b><a href="#continue">continue</a></b>
      </div>




      <div class="description">
        <em>Continue</em> iteration function to decide whether cursor should continue to next record.
      </div>
    </td>
  </tr>




  <tr>



    <td class="attributes">&nbsp;</td>




    <td class="nameDescription">



      <div class="fixedFont">
        <b><a href="#map">map</a></b>
      </div>




      <div class="description">
        <em>Map</em> iteration function to transform the current cursor value.
      </div>
    </td>
  </tr>




  <tr>



    <td class="attributes">&nbsp;</td>




    <td class="nameDescription">



      <div class="fixedFont">
        <b><a href="#reduce">reduce</a></b>
      </div>




      <div class="description">
        <em>Reduce</em> iteration function to perform reduce operation of the current currsor value.
      </div>
    </td>
  </tr>

  </tbody>
</table>


<table cellspacing="0" class="summaryTable">


  <caption>
    Method Summary
  </caption>



  <thead>


  <tr>



    <th>Method Attributes</th>




    <th>Method Name and Description</th>
  </tr>
  </thead>



  <tbody>



  <tr>


    <td class="attributes">&nbsp;</td>


    <td class="nameDescription">


      <div class="fixedFont">
        <b><a href="#average">average</a></b>(field)
      </div>


      <div class="description">
        Get average value of a given field.
      </div>
    </td>
  </tr>


  <tr>


    <td class="attributes">&nbsp;</td>


    <td class="nameDescription">


      <div class="fixedFont">
        <b><a href="#count">count</a></b>()
      </div>


      <div class="description">
        Count records.
      </div>
    </td>
  </tr>



  <tr>


    <td class="attributes">&nbsp;</td>


    <td class="nameDescription">


      <div class="fixedFont">
        <b><a href="#get">get</a></b>()
      </div>


      <div class="description">
        Retrieve the first object.
      </div>
    </td>
  </tr>




  <tr>



    <td class="attributes">&nbsp;</td>




    <td class="nameDescription">



      <div class="fixedFont">
        <b><a href="#fetch">fetch</a></b>(max, skip)
      </div>




      <div class="description">
        Retrieve the query result.
      </div>
    </td>
  </tr>




  <tr>


    <td class="attributes">&nbsp;</td>


    <td class="nameDescription">


      <div class="fixedFont">
        <b><a href="#select">select</a></b>(fields)
      </div>


      <div class="description">
        Count records.
      </div>
    </td>
  </tr>


  <tr>


    <td class="attributes">&nbsp;</td>


    <td class="nameDescription">


      <div class="fixedFont">
        <b><a href="#sum">sum</a></b>(field)
      </div>


      <div class="description">
        Count records.
      </div>
    </td>
  </tr>


  <tr>


    <td class="attributes">&nbsp;</td>


    <td class="nameDescription">


      <div class="fixedFont">
        <b><a href="#where">where</a></b>(field, operator1, value2, opt_operator1, opt_value2)
      </div>


      <div class="description">
        Count records.
      </div>
    </td>
  </tr>


  </tbody>
</table>



<div class="details">
  <a name="constructor"></a>
  <p>
  There are two ways to construct a query. Query are constructed by its constructor
  <code>new ydn.db.Query(...)</code> or factory method <code>query</code> from <code>ydn.db.Storage</code>
    instance.
</p>

  <div class="fixedFont">
    <b>Query</b>(store_name)
  </div>




  <div class="description">
    Query is created from the factory method in <code>ydn.db.Storage</code> as <code>db.query(store_name)</code>.
    Store-wise query is created of a given <code>store_name</code>.
  </div>




  <dl class="detailList">
    <dt class="heading">Parameters:</dt>

    <dt><span class="light fixedFont optional">{string}</span> <b>store_name</b></dt>

    <dd>Store name.</dd>

  </dl>


  <hr>


  <div class="fixedFont">
    <b>Query</b>(store_name, index, direction, key_range)
  </div>



  <dl class="detailList">
    <dt class="heading">Parameters:</dt>

    <dt><span class="light fixedFont">{string}</span> <b>store_name</b></dt>

    <dd>Store name.</dd>

    <dt><span class="light fixedFont">{string=}</span> <b>direction</b></dt>

    <dd>Optional cursor direction: <code>next</code> (default), <code>prev</code>, <code>nextunique</code>, <code>prevunique</code>.</dd>

    <dt><span class="light fixedFont">{IDBKeyRange}</span> <b>key_range</b></dt>

    <dd>Key range in JSON format as follow:</dd>
<pre>key_range = {
    lower: lower_value,     // optional, either number or string
    upper: upper_value,     // optional, either number or string
    lowerOpen: true,        // optional, boolean
    upperOpen: true         // optional, boolean
}
</pre>
  </dl>



  <hr>


  <div class="fixedFont">
    <b>Query</b>(store_name, index, direction, lower, upper, lowerOpen, upperOpen)
  </div>


  <dl class="detailList">
    <dt class="heading">Parameters:</dt>

    <dt><span class="light fixedFont">{string}</span> <b>store_name</b></dt>

    <dd>Store name.</dd>

    <dt><span class="light fixedFont">{string}</span> <b>direction</b></dt>

    <dd>Optional cursor direction: <code>next</code> (default), <code>prev</code>, <code>nextunique</code>, <code>prevunique</code>.</dd>

    <dt><span class="light fixedFont">{number|string|undefined}</span> <b>lower</b></dt>

    <dd>Lower bound of the key range.</dd>

    <dt><span class="light fixedFont">{number|string|undefined}</span> <b>upper</b></dt>

    <dd>Upper bound of the key range.</dd>

    <dt><span class="light fixedFont">{boolean}</span> <b>lowerOpen</b></dt>

    <dd>False if the lower-bound value is included in the key range.</dd>

    <dt><span class="light fixedFont">{boolean}</span> <b>upperOpen</b></dt>

    <dd>False if the upper-bound value is included in the key range.</dd>
  </dl>

</div>



<div class="sectionTitle">
  Field Detail
</div>


<a name="filter"></a>
<div class="fixedFont">
  <b>filter</b> = <span class="light">{function(!Object): boolean}</span>
</div>
<div class="description">
  <em>Filter</em> iteration function return <code>true</code> to put current into the result.
</div>
<dl class="detailList">
  <dt class="heading">Iteration function parameters:</dt>
  <dt><span class="light fixedFont">{!Object}</span> <b>currentValue</b></dt>
  <dd>Current cursor value.</dd>
</dl>
<dl name="class-detailList">
  <dt name="class-heading">Returns:</dt>
  <dd><span name="class-light fixedFont">{boolean}</span> <code>true</code> to collect the current record.</dd>
</dl>
<hr>


<a name="continue"></a>
<div class="fixedFont">
  <b>continue</b> = <span class="light">{function(!Object): boolean}</span>
</div>
<div class="description">
  <em>Continue</em> iteration function return <code>true</code> to continue cursor. This is immediate evaluate after <code>filter </code>function.
</div>
<dl class="detailList">
  <dt class="heading">Iteration function parameters:</dt>
  <dt><span class="light fixedFont">{!Object}</span> <b>currentValue</b></dt>
  <dd>Current cursor value.</dd>
</dl>
<dl name="class-detailList">
  <dt name="class-heading">Returns:</dt>
  <dd><span name="class-light fixedFont">{boolean}</span> <code>true</code> to continue the cursor.</dd>
</dl>
<hr>


<a name="map"></a>
<div class="fixedFont">
  <b>map</b> = <span class="light">{function(!Object): *}</span>
</div>
<div class="description">
  <em>Map</em> iteration function transform current cursor value into any.
  <br>
  This is evaluate after <code>continue </code>function. Map iteration function is ignored if <code>reduce</code> is defined.
</div>
<dl class="detailList">
  <dt class="heading">Iteration function parameters:</dt>
  <dt><span class="light fixedFont">{!Object}</span> <b>currentValue</b></dt>
  <dd>Current cursor value.</dd>
</dl>
<dl name="class-detailList">
  <dt name="class-heading">Returns:</dt>
  <dd><span name="class-light fixedFont">{*}</span> Any value to put into the results.</dd>
</dl>
<hr>


<a name="reduce"></a>
<div class="fixedFont">
  <b>reduce</b> = <span class="light">{function(previousValue, currentValue, index): *}</span>
</div>
<div class="description">
  <em>Reduce</em> iteration function perform reduce operation to current cursor value.
  <br>
  This is evaluate after <code>continue </code>function.
</div>
<dl class="detailList">
  <dt class="heading">Iteration function parameters:</dt>
  <dt><span class="light fixedFont">{!Object}</span> <b>previousValue</b></dt>
  <dd>Previous result value.
    At <code>index</code> is <code>0</code>, <code>previousValue</code> value is <code>undefined</code>.</dd>
  <dt><span class="light fixedFont">{!Object}</span> <b>currentValue</b></dt>
  <dd>Current cursor value.</dd>
</dl>
<dl name="class-detailList">
  <dt name="class-heading">Returns:</dt>
  <dd><span name="class-light fixedFont">{*}</span> return any value, this become <code>previousValue</code> and finally result value.</dd>
</dl>
<hr>

<div class="sectionTitle">
  Method Detail
</div>

<a name="average"></a>
<div class="fixedFont">
  <span class="light">{!goog.async.Deferred}</span> <b>average</b>(field)
</div>
<div class="description">
  Prepare <i>map</i> iteration method for calculate average value of given field.
</div>
<dl class="detailList">
  <dt class="heading">Parameters:</dt>
  <dt><span class="light fixedFont">{string}</span> <b>field</b></dt>
  <dd>Object field name. The field value will coerce to number.</dd>
</dl>
<dl class="detailList">
  <dt class="heading">Returns:</dt>
  <dd><span class="light fixedFont">{!ydn.db.Query}</span> for changing.</dd>
</dl>
<hr>

<a name="count"></a>
<div class="fixedFont">
  <span class="light">{!goog.async.Deferred}</span> <b>count</b>()
</div>
<div class="description">
  Prepare <i>reduce</i> iteration method for count the number of result.
</div>
<dl class="detailList">
  <dt class="heading">Returns:</dt>
  <dd><span class="light fixedFont">{!ydn.db.Query}</span> for changing.</dd>
</dl>

<hr>



<a name="get"></a>
<div class="fixedFont">
  <span class="light">{!goog.async.Deferred}</span> <b>get</b>()
</div>
<div class="description">
  Get the first query result.
</div>
<dl class="detailList">
  <dt class="heading">Returns:</dt>
  <dd><span class="light fixedFont">{!goog.async.Deferred}</span> object in deferred function.</dd>
</dl>
<hr>


<a name="fetch"></a>


<div class="fixedFont">
  <span class="light">{!goog.async.Deferred}</span> <b>fetch</b>(max, skip)
</div>


<div class="description">
  Fetch the query result in array list.
</div>

<dl class="detailList">
  <dt class="heading">Parameters:</dt>

  <dt><span class="light fixedFont">{number=}</span> <b>max</b></dt>

  <dd>Optional. The maximum number of results to collect.</dd>

  <dt><span class="light fixedFont">{number=}</span> <b>skip</b></dt>

  <dd>Optional. Number of results to skip before collecting.</dd>
</dl>

<dl class="detailList">
  <dt class="heading">Returns:</dt>

  <dd><span class="light fixedFont">{!goog.async.Deferred}</span> resulting objects in a <code>Array</code> in deferred function.</dd>
</dl>

<hr>



<a name="select"></a>


<div class="fixedFont">
  <span class="light">{!goog.async.Deferred}</span> <b>select</b>(fields)
</div>


<div class="description">
  Prepare <i>map</i> iteration method retrieves fields of resulting records.
</div>

<dl class="detailList">
  <dt class="heading">Parameters:</dt>

  <dt><span class="light fixedFont">{string|!Array.}</span> <b>fields</b></dt>

  <dd>Fields to select.</dd>

</dl>

<dl class="detailList">
  <dt class="heading">Returns:</dt>
  <dd><span class="light fixedFont">{!ydn.db.Query}</span> for changing.</dd>
</dl>


<hr>


<a name="sum"></a>


<div class="fixedFont">
  <span class="light">{!goog.async.Deferred}</span> <b>sum</b>(field)
</div>


<div class="description">
  Prepare <i>reduce</i> iteration method to calculate the sum of results of given field.
</div>

<dl class="detailList">
  <dt class="heading">Parameters:</dt>

  <dt><span class="light fixedFont">{string}</span> <b>field</b></dt>

  <dd>Target field.</dd>

</dl>

<dl class="detailList">
  <dt class="heading">Returns:</dt>
  <dd><span class="light fixedFont">{!ydn.db.Query}</span> for changing.</dd>
</dl>


<hr>

<a name="where"></a>


<div class="fixedFont">
  <span class="light">{!goog.async.Deferred}</span> <b>where</b>(field, operator, value, operator2, value2)
</div>


<div class="description">
  Prepare <i>filter</i> iteration method for WHERE predicate filter. Record for which the predicate evaluates to falsy value are excluded in the query result.
</div>

<dl class="detailList">
  <dt class="heading">Parameters:</dt>

  <dt><span class="light fixedFont">{string}</span> <b>field</b></dt>

  <dd>Target field name.</dd>

  <dt><span class="light fixedFont">{string}</span> <b>operator</b></dt>

  <dd>Operator: valid values are: <code>=, ==, ===, !=, !==, &lt;, &gt;, =&gt;, &lt;= </code></dd>

  <dt><span class="light fixedFont">{string}</span> <b>value</b></dt>

  <dd>Value to perform logical operation against the field value.</dd>


  <dt><span class="light fixedFont">{string}</span> <b>operator2</b></dt>

  <dd>Optional second operator</dd>

  <dt><span class="light fixedFont">{string}</span> <b>value2</b></dt>

  <dd>Optional second value to perform logical operation against the field value.</dd>
</dl>

<dl class="detailList">
  <dt class="heading">Returns:</dt>
  <dd><span class="light fixedFont">{!ydn.db.Query}</span> for changing.</dd>
</dl>


<hr>
